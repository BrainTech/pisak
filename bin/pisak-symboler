#!/usr/bin/env python3

"""
Main module of the symboler application. Launching and managing all the
application's views takes place here.
"""
import sys

import pisak
from pisak import app_manager, res, handlers
from pisak.symboler import symbols_manager

import pisak.symboler.widgets  # @UnusedImport
import pisak.symboler.handlers  # @UnusedImport


def prepare_symboler_view(app, window, script, data):
    handlers.button_to_view(window, script, "button_exit")

    data_source = script.get_object('data_source')
    categories_dict, toc, flat_data = symbols_manager.parse_from_spreadsheets()
    if flat_data:
        data_source.custom_topology = True
        data = flat_data
        app.box['categories_dict'] = categories_dict
        app.box['toc'] = toc
        app.box['flat_data'] = flat_data
    else:
        data = symbols_manager.get_all_symbols()
    data_source.data = data


if __name__ == "__main__":
    pisak.init()
    _symboler_app = {
        "app": "symboler",
        "type": "clutter",
        "views": [("main", prepare_symboler_view)]
    }
    symbols_manager.create_model()
    app_manager.run(_symboler_app)
